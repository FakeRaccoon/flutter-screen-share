<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>WebRTC Screen Viewer</title>
  </head>
  <body>
    <h1>WebRTC Screen Viewer</h1>

    <video
      id="remote-video"
      autoplay
      playsinline
      muted
      style="width: 80%; border: 2px solid black"
    ></video>

    <script>
      let peerConnection = new RTCPeerConnection({
        iceServers: [],
      });

      let socket = new WebSocket("ws://10.10.4.14:4000");

      socket.onopen = () => {
        console.log("üîó WebSocket Connected!");
      };

      socket.onmessage = async (event) => {
        let data = JSON.parse(event.data);
        console.log("üì© Received from WebSocket:", data);

        if (data.type === "offer") {
          console.log("üîÑ Received Offer ‚Üí Generating Answer...");
          await peerConnection.setRemoteDescription(
            new RTCSessionDescription(data)
          );

          let answer = await peerConnection.createAnswer();
          await peerConnection.setLocalDescription(answer);

          socket.send(JSON.stringify({ type: "answer", sdp: answer.sdp }));
          console.log("üì§ Sent Answer to WebSocket");
        } else if (data.type === "answer") {
          console.log("‚úÖ Received Answer ‚Üí Applying...");
          await peerConnection.setRemoteDescription(
            new RTCSessionDescription(data)
          );
        } else if (data.type === "candidate") {
          console.log("üîÄ Adding ICE Candidate");
          peerConnection.addIceCandidate(new RTCIceCandidate(data.candidate));
        }
      };

      peerConnection.ontrack = (event) => {
        console.log("üé• Track event received:", event);
        if (event.streams.length > 0) {
          document.getElementById("remote-video").srcObject = event.streams[0];
        } else {
          console.log("‚ö†Ô∏è No stream attached to track event.");
        }
      };
    </script>
  </body>
</html>
